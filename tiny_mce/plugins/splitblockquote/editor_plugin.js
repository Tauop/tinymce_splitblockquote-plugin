(function(){tinymce.create("tinymce.plugins.SplitBlockquote",{getInfo:function(){return{longname:"Split Blockquote",author:"pguiran@linagora.com",authorurl:"http://github.com/Tauop/tinymce_splitblockquote-plugin/",infourl:"http://www.linagora.com/",version:"0.1"}},init:function(a,b){a.onKeyPress.add(function(l,n){var d,g,c,q,k,f,p;if(n.keyCode!=13){return}function o(s,i){var e=null;while(s){if(s==i){break}if(s.nodeName==="BLOCKQUOTE"){e=s}s=s.parentNode}return e}function j(t,i){function s(r){if(r.nodeName==="FONT"&&l.settings.convert_fonts_to_spans){return"</span>"}else{return"</"+r.nodeName.toLowerCase()+">"}}var e="";while(t){if(t==i){break}e+=s(t);t=t.parentNode}return e}function h(t,s){function i(v){var r,u;u=v.cloneNode(false);u.innerHTML="";r=l.dom.getOuterHTML(u).replace(new RegExp("<"+u.nodeName,"i"),"").replace(new RegExp("</"+u.nodeName+">","i"),"");return"<"+u.nodeName.toLowerCase()+r}var e="";while(t){if(t==s){break}e=i(t)+e;t=t.parentNode}return e}c=l.selection.getNode();q=o(c,l.getBody());if(!q){return}p="_$"+(new Date()).getTime()+"$_";l.selection.setContent(p,{formar:"raw"});d=l.getContent().split(p);k=h(c,q);f=j(c,q);if(l.settings.convert_fonts_to_spans&&k!=""){(function(){var e=(k.match(/<font/ig)||[]).length;for(g=0;g<e;++g){start_idx=d[1].indexOf("</span>");if(start_idx!=-1){d[1]=d[1].substring(0,start_idx)+"</font>"+d[1].substring(start_idx+7)}}})()}l.setContent(d[0]+f+'</blockquote><br id="__"><blockquote>'+k+d[1]);function m(i){var e;if(i==null||i.nodeName!="P"){return}e=i.innerHTML.trim();if(e==""||e=='<br mce_bogus="1">'||e=="<br>"){l.dom.remove(i)}}q=l.getBody().getElementsByTagName("blockquote");for(g=0;g<q.length;++g){if(q[g]==null){continue}m(q[g].firstChild);m(q[g].lastChild);if(q[g].innerHTML.trim()===""){l.dom.remove(q[g])}}c=l.dom.get("__");c.removeAttribute("id");l.selection.select(c);l.selection.collapse(true);return tinymce.dom.Event.cancel(n)})}});tinymce.PluginManager.add("splitblockquote",tinymce.plugins.SplitBlockquote)})();